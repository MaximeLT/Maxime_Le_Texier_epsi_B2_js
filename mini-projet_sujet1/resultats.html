<!DOCTYPE html>
<html>
<head>
	<title>Resultats</title>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script type="text/javascript">
		var xhttp = new XMLHttpRequest();
		var parsedResults = null;


		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				parsedResults = JSON.parse(this.responseText);

				var classement = [];
				for (var i = 0; i < parsedResults.table[0].liste.length; i++) {
					classement[i] = []
					classement[i][1] = 0;
				}

				for (var i = 0; i < parsedResults.table.length; i++) {
					parsedResults.table[i].liste.sort(compare);
					for (var j = 0; j < parsedResults.table[i].liste.length; j++) {
						parsedResults.table[i].liste[j][1] = parsedResults.table[i].liste[j].length + (j-1);
					}
				}

				for (var i = 0; i < parsedResults.table.length; i++) {
					for (var j = 0; j < parsedResults.table[i].liste.length; j++) {
						if (parsedResults.table[i].liste[j][0] == "Brest") {
							classement[0][0] = "Brest";
							classement[0][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Bordeaux") {
							classement[1][0] = "Bordeaux";
							classement[1][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Grenoble") {
							classement[2][0] = "Grenoble";
							classement[2][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Arras") {
							classement[3][0] = "Arras";
							classement[3][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Lille") {
							classement[4][0] = "Lille";
							classement[4][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Lyon") {
							classement[5][0] = "Lyon";
							classement[5][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Montpellier") {
							classement[6][0] = "Montpellier";
							classement[6][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Paris") {
							classement[7][0] = "Paris";
							classement[7][1] += parsedResults.table[i].liste[j][1];
						}
						if (parsedResults.table[i].liste[j][0] == "Nantes") {
							classement[8][0] = "Nantes";
							classement[8][1] += parsedResults.table[i].liste[j][1];
						}
					}
				}
				console.log(parsedResults);
				console.log(classement.sort(compare));
				document.getElementById('p1').innerHTML = classement.sort(compare);

			}
		}

		xhttp.open("GET", "http://localhost:3000/notation?type=dataJSON", true);
		xhttp.send();

		function compare(a,b) {
			if (parseInt(a[1]) < parseInt(b[1])) return -1;
			if (parseInt(a[1]) > parseInt(b[1])) return 1;
			return 0;
		}
	</script>
</head>
<body>
	<p id="p1"></p>
</body>
</html>